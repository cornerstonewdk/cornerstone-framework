// Generated by CoffeeScript 1.3.3
var DocPad, docpadConfig, serverAction;

DocPad = require(__dirname + '/../lib/docpad');

docpadConfig = {};

serverAction = process.env.DOCPAD_SERVER_ACTION || 'generate server';

(function() {
  var actionArgumentIndex;
  actionArgumentIndex = process.argv.indexOf('--action');
  if (actionArgumentIndex !== -1) {
    return serverAction = process.argv[actionArgumentIndex + 1];
  }
})();

(function() {
  var portArgument, portArgumentIndex;
  portArgument = null;
  portArgumentIndex = process.argv.indexOf('--port');
  if (portArgumentIndex !== -1) {
    portArgument = process.argv[portArgumentIndex + 1];
    if (isNaN(portArgument)) {
      portArgument = null;
    } else {
      portArgument = parseInt(portArgument, 10);
    }
  }
  if (portArgument) {
    return docpadConfig.port = portArgument;
  }
})();

DocPad.createInstance(docpadConfig, function(err, docpad) {
  if (err) {
    return console.log(err.stack);
  }
  return docpad.action(serverAction, function(err) {
    if (err) {
      return console.log(err.stack);
    }
    return console.log('OK');
  });
});
