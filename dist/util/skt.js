/*
    Cornerstone Framework v0.9.2

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
(function(e,t){function f(e,t){t?t(e):console.log("handler is not define")}function l(e,t){var n=!1;for(var r in t)e[t[r]]||(f({result:"fail",resultCode:"1",message:t[r]+" is require."},e.error),n=!0);return n}typeof exports!="undefined"?Backbone=exports:Backbone=t.Backbone={};var n=t.SKT={authFrame:undefined},r,i="http://cornerstone.sktelecom.com",s=i+"/oauth/authorize",o=i+"/sms",u=i+"/payment",a=function(e){this.options=e};n.authorize=function(e){return r=new a(e),r.init(),r},n.authSuccess=function(i){var s=i.hash.substr(1).split("&"),o={};for(var u=0;u<s.length;u++){var a=s[u].split("=");o[a[0]]=a[1]}e("#"+n.authFrame)&&(e("#"+n.authFrame).remove(),n.authFrame=undefined,e(t).off("resize"));if(!o.access_token)return r.options.error({result:"fail",resultCode:"1",message:"access_token is not valid."}),!1;r.success(decodeURIComponent(o.access_token))},a.prototype={defaults:{client_id:undefined,redirect_uri:undefined,response_type:"token"},init:function(){var r=["clientId","redirectUri"];if(l(this.options,r))return!1;var i={client_id:this.options.clientId,redirect_uri:encodeURI(this.options.redirectUri)};this.success=this.options.success,e.extend(this.defaults,i);if(!n.authFrame){n.authFrame="skt_auth_iframe_"+Math.floor(Math.random()*1e3)+1;var o=e("<button>close</button>",{type:"button"}).css({left:"10px",top:"10px",position:"absolute","font-size":"15px"});o.on("click",function(r){e("#"+n.authFrame).remove(),n.authFrame=undefined,e(t).off("resize")});var u=e("<div></div>",{id:n.authFrame}).css({"z-index":"10000",left:"0px",top:"0px",width:t.innerWidth+"px",height:t.innerHeight+"px",position:"absolute","background-color":"gray"});e(t).on("resize",function(e){u.css({width:e.currentTarget.innerWidth+"px",height:e.currentTarget.innerHeight+"px"}),a.css({width:e.currentTarget.innerWidth+"px",height:e.currentTarget.innerHeight+"px"})});var a=e("<iframe></iframe>",{src:s+"?"+e.param(this.defaults)}).css({width:t.innerWidth+"px",height:t.innerHeight+"px","background-color":"gray"});a.appendTo(u),o.appendTo(u),u.appendTo("body")}else e("#"+n.authFrame).attr("src",s+"?"+e.param(this.defaults))},success:function(){}},n.sendSms=function(t){var n=["accessToken","from","to","message"];if(l(t,n))return!1;var r={access_token:t.accessToken,from:t.from,to:t.to,message:encodeURIComponent(t.message)};e.ajax({url:o,data:r,dataType:"jsonp",jsonp:"callback",jsonpCallback:"success",timeout:t.timeout||5e3,success:function(e){e.resultCode==1?f(e,t.error):f(e,t.success)},error:function(e,n,r){f({result:"fail",resultCode:"1",message:"time out."},t.error)}})},n.pay=function(t){var n=["accessToken","type","amount","to"];t.type!=="one-time"&&t.type!=="recurring"&&n.push("paymentDate");if(l(t,n))return!1;var r={access_token:t.accessToken,type:t.type,amount:t.amount,payment_date:t.paymentDate,to:t.to};e.ajax({url:u,data:r,dataType:"jsonp",jsonp:"callback",jsonpCallback:"success",timeout:t.timeout||5e3,success:function(e){e.resultCode==1?f(e,t.error):f(e,t.success)},error:function(e,n,r){f({result:"fail",resultCode:"1",message:"time out."},t.error)}})}})(jQuery,window)